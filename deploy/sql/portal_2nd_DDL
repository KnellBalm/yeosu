CREATE TABLE IF NOT EXISTS yeosu_dm.tb_flowpop (
    id          CHAR(8),
    type        VARCHAR(20),
    timezn_cd   VARCHAR(10),
    m10         DOUBLE PRECISION,
    m20         DOUBLE PRECISION,
    m30         DOUBLE PRECISION,
    m40         DOUBLE PRECISION,
    m50         DOUBLE PRECISION,
    m60         DOUBLE PRECISION,
    m70         DOUBLE PRECISION,
    f10         DOUBLE PRECISION,
    f20         DOUBLE PRECISION,
    f30         DOUBLE PRECISION,
    f40         DOUBLE PRECISION,
    f50         DOUBLE PRECISION,
    f60         DOUBLE PRECISION,
    f70         DOUBLE PRECISION,
    total       DOUBLE PRECISION,
    etl_ymd     DATE NOT NULL
)
PARTITION BY RANGE (etl_ymd);

-- KCB 집계 테이블
CREATE TABLE IF NOT EXISTS yeosu_dm.tb_kcb(
    qid50                  CHAR(8) NOT NULL,
    bs_yr_mon              CHAR(6) NOT NULL,  -- YYYYMM 형식
    sic_cd_lv4             VARCHAR(10),
    shop_cnt               INTEGER,
    op_cnt                 INTEGER,
    new_opn_cnt            INTEGER,
    run_out_cnt            INTEGER,
    tot_sale_amt           NUMERIC(18,2),
    tot_sales_amt0_cnt     INTEGER,
    tot_sales_amt5_cnt     INTEGER,
    sic_fst_clsfy_itm_nm   VARCHAR(100),
    sic_scnd_clsfy_itm_nm  VARCHAR(100),
    sic_trd_clsfy_itm_nm   VARCHAR(100),
    sic_four_clsfy_itm_nm  VARCHAR(100),
    created_at             TIMESTAMP DEFAULT NOW()
);
-- 날짜 캐스팅 인덱스 (기간 비교를 위한 WHERE 절에서 활용)
CREATE INDEX IF NOT EXISTS idx_tb_kcb_bs_yr_mon_date
    ON yeosu_dm.tb_kcb((to_date(bs_yr_mon, 'YYYYMM')));

-- 지역화폐 집계 테이블
CREATE TABLE IF NOT EXISTS yeosu_dm.tb_local_pay_agg (
    grid_id                 CHAR(8) NOT NULL,    
    std_ym                  CHAR(6) NOT NULL,  -- YYYYMM 형식
    ind_type                VARCHAR(50),
    pay_cnt                 INTEGER,
    pay_amt                 INTEGER
)
CREATE INDEX IF NOT EXISTS idx_tb_local_pay_std_ym
    ON yeosu_dm.tb_kcb((to_date(std_ym, 'YYYYMM')));